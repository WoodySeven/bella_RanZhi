#!/usr/bin/env python
"""小工具的函数"""
from config import *
from selenium import webdriver
import time
from lib.utils import *


def get_driver():
    """获取driver对象"""
    driver = webdriver.Chrome()
    driver.implicitly_wait(30)
    return driver


def login_by_admin(driver):
    """管理员登录"""
    driver.find_element_by_id("account").clear()
    driver.find_element_by_id("account").send_keys(ADMIN_ACCOUNT['account'])
    driver.find_element_by_id("password").clear()
    driver.find_element_by_id("password").send_keys(ADMIN_ACCOUNT['password'])
    driver.find_element_by_id("submit").click()
    time.sleep(3)


def click_backend_management(driver):
    """点击后台管理"""
    driver.find_element_by_xpath('//*[@id="s-menu-superadmin"]/button').click()
    time.sleep(2)


def click_all_apps(driver):
    """点击所有应用"""
    driver.find_element_by_xpath("//*[@id=\"s-menu-allapps\"]/button").click()
    time.sleep(3)


def click_crm_btn(driver):
    """点击客户管理"""
    driver.find_element_by_xpath("//*[@id=\"s-applist-1\"]/a/img").click()
    time.sleep(3)


def switch_to_frame(driver, frame_name='iframe-1'):
    ##进入ifarme
    driver.switch_to.frame(frame_name)
    time.sleep(5)


def add_customer(driver):
    """新增客户"""
    name = get_random_customer_name()
    contact = get_random_string()
    phone = get_random_phone()
    email = "{}@qq.com".format(name)
    qq = phone
    logging.info("test data is : name {0},phone {1}, email {2}".format(name, phone, email))

    switch_to_frame(driver, 'iframe-1')
    driver.find_element_by_link_text("客户").click()
    driver.find_element_by_xpath('//*[@id="menuActions"]/a').click()  ##点击添加客户
    driver.find_element_by_id("name").send_keys(name)  ##输入名称
    driver.find_element_by_id("contact").send_keys(contact)  ##输入联系人
    driver.find_element_by_id("phone").send_keys(phone)  ##输入电话
    driver.find_element_by_id("email").send_keys(email)  ##输入邮箱
    driver.find_element_by_id("qq").send_keys(qq)  ##输入qq
    driver.find_element_by_id("type").click()  ##选择类型
    driver.find_element_by_xpath('//*[@id="type"]/option[2]').click()
    time.sleep(3)
    driver.find_element_by_id("size").click()  ##选择规模
    driver.find_element_by_xpath('//*[@id="size"]/option[2]').click()
    driver.find_element_by_id("level").click()  ##选择级别
    driver.find_element_by_xpath('//*[@id="level"]/option[2]').click()
    driver.find_element_by_id('intension').send_keys("客户意向非常大")  ##购买意向输入
    driver.find_element_by_id("submit").click()  ##点击保存
    time.sleep(3)
    return {"name": name, "phone": phone}


def add_member(driver):
    """添加成员"""
    ##进入ifarme
    switch_to_frame(driver, 'iframe-superadmin')
    #点击添加成员按钮
    driver.find_element_by_xpath('//*[@id="shortcutBox"]/div/div[1]/div/a/h3').click()

    name = get_random_customer_name()
    email = "{}@qq.com".format(name)

    ##用户名
    driver.find_element_by_id('account').send_keys(name)
    ##真实姓名
    driver.find_element_by_id('realname').send_keys(name)
    driver.find_element_by_id('gender2').click()  ##选择性别
    driver.find_element_by_id('dept').click()  ##选择部门
    driver.find_element_by_xpath('//*[@id="dept"]/option[2]').click()
    driver.find_element_by_id('role').click()  ##选择角色
    driver.find_element_by_xpath('//*[@id="role"]/option[3]').click()
    driver.find_element_by_id('password1').send_keys('123456')  ##输入密码
    driver.find_element_by_id('password2').send_keys('123456')  ##再一次输入密码
    ##输入邮箱
    driver.find_element_by_id('email').send_keys(email)
    driver.find_element_by_id('submit').click()  ##点击保存
    time.sleep(6)
    return {"name": name, "email": email}